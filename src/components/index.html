<!DOCTYPE html>
<html lang="en" class="bg-gray-50 text-slate-700 text-lg">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CMC-MVP</title>
    <link href="/styles.css" rel="stylesheet" />
  </head>
  <body class="md:px-32 px-8 py-8">
    <div id="nav_container">
    <button class="btn btn-soft btn-accent" onclick="handleNew()">New</button>
    <button class="btn btn-soft btn-accent" onclick="handleEdit()">Edit</button>
    </button>
  </div>
    </div>
    <main id="main_content"></main>
  </body>
  <script>
      async function handleNew() {
    let url = window.prompt("Enter new URL:");
    const urlPattern = /^\/.*/;
    if (!urlPattern.test(url)) {      
      alert(
        "Invalid URL:\nAllowed pattern examples include '/pagename', '/this123/more-text', etc."
      );
      return
    }


    const res = await window.fetch(`/data?url=${url}`).then(async (res) => {
      const body = await res.json();
      return body;
    });
    if (!res) {
      await window
        .fetch("/create", {
          headers: { "content-type": "application/json" },
          method: "POST",
          body: JSON.stringify({
            url: url,
            content: "# Page Title\nWelcome to your new page.",
          }),
        })
        .then((res) => {
          window.location.assign(`/editor?url=${url}`);
        });
    } else {
      await alert("Page already exists.\nRerouting to existing content.");
      window.location.assign(`/editor?url=${url}`);
    }
  }

    async function handleEdit() {
      window.location.assign(`/editor?url=${window.location.pathname}`)
    }
  </script>
</html>
